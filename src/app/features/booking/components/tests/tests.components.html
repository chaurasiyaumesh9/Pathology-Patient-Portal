<div class="container">
    <div class="row">
        <!-- LEFT: Categories -->
        <aside class="col-lg-3 col-md-4 mb-4">
            <h6 class="mb-3">Categories</h6>

            @if (categories$ | async; as categories) {
            <div class="list-group">
                <!-- All Tests -->
                <a class="list-group-item list-group-item-action" [class.active]="!selectedCategoryId()"
                    routerLink="/booking/tests">
                    All Services
                </a>

                @for (category of categories; track category.id) {
                <a class="list-group-item list-group-item-action" [class.active]="selectedCategoryId() === category.id"
                    [routerLink]="['/booking/tests', category.id]">
                    {{ category.name }}
                </a>
                }
            </div>
            }
        </aside>

        <!-- RIGHT: Tests -->
        <section class="col-lg-9 col-md-8">
            <div class="mb-3">
                <h2 class="mb-1">Select Services</h2>
                <p class="text-muted mb-4">
                    Choose from available diagnostic services.
                </p>
            </div>

            @if (tests$ | async; as tests) {
            @if (tests.length === 0) {
            <div class="alert alert-light border">
                No services available for this category.
            </div>
            } @else {
            <div class="row g-3">
                @for (test of tests; track test.id) {
                <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12">
                    <div class="card h-100">
                        <div class="card-body d-flex flex-column">
                            <h6 class="card-title mb-2">
                                {{ test.name }}
                            </h6>

                            <div class="text-muted mb-3">
                                â‚¹{{ test.discounted_price || test.original_price }}
                            </div>

                            <div class="mt-auto text-end">
                                @if (!isSelected(test.id)) {
                                <button class="btn btn-sm btn-primary" (click)="addTest(test)">
                                    Add
                                </button>
                                } @else {
                                <button class="btn btn-sm btn-outline-secondary" (click)="removeTest(test.id)">
                                    Remove
                                </button>
                                }
                            </div>
                        </div>
                    </div>
                </div>
                }
            </div>
            }
            } @else {
            <div class="text-center my-5">
                <div class="spinner-border text-primary"></div>
            </div>
            }
        </section>
    </div>
</div>